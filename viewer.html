<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sample Name</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f6f8fa;
      color: #24292e;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: #ffffff;
      padding: 30px 20px; /* Increased padding for top/bottom */
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .static-header {
      position: sticky;
      top: 0;
      background-color: #ffffff;
      z-index: 10;
      padding-bottom: 10px;
      border-bottom: 2px solid #d0d7de;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #d0d7de;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f6f8fa;
      font-weight: bold;
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    /* Add space between the containers */
    .container:first-of-type {
      margin-bottom: 20px;
    }
    /* Make the second container fill the remaining vertical space */
    .container:last-of-type {
      flex-grow: 0; /* Changed from 1 to 0 */
      margin: 0 auto;
      max-width: 600px; /* Reduced max-width to slim the container */
      margin-bottom: 20px;
      width: 100%; /* Ensure the container takes up full width */
    }
    /* Ensure the table in the second container takes full width */
    .container:last-of-type table {
      width: 100%;
    }
    .column-list {
      display: flex;
      flex-direction: column;
      width: 100%; /* Ensure the column list takes up full width */
    }
    .column-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 10px; /* Increased padding */
      font-size: 18px;
      border-bottom: 1px solid #d0d7de;
    }
    .column-item:last-child {
      border-bottom: none;
    }
    .empty-cell {
      width: 50%;
      text-align: right;
      border-left: 1px solid #d0d7de; /* Add a left border to the empty cells */
      padding: 15px 10px; /* Increased padding */
    }
    .bottom-line {
      border-bottom: 2px solid #d0d7de;
      margin-top: 20px; /* Add some space above the line */
    }
    .column-name {
      width: 50%;
      text-align: center; /* Center the column names */
    }
  </style>
</head>
<body>
  <div class="container" style="max-width: 600px;">
    <div class="static-header" style="display: flex; align-items: center; justify-content: center;">
      <button id="backButton" style="background-color: green; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px; box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3); font-family: sans-serif; font-size: 16px;">&lt;</button>
      <span style="width: 50px;"></span> <!-- Spacer -->
      <h1 style="margin-left: 10px; margin-right: 10px;">Sample Name</h1>
      <span style="width: 50px;"></span> <!-- Spacer -->
      <button id="forwardButton" style="background-color: green; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px; box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3); font-family: sans-serif; font-size: 16px;">&gt;</button>
    </div>
    <div id="evaInfo" style="text-align: center; padding: 12px; color: #586069; font-size: 16px;">
      EVA __ Station __ Sample# __ of __
    </div>
    <div style="text-align: center; margin-top: 10px;color: #d0d7de;">
      # <span id="pageCount" style="color: #d0d7de;">1</span>
    </div>
  </div>

  <div class="container">
    <div class="column-list">
      <div class="column-item">
        <span class="column-name">Timestamp</span>
        <span class="empty-cell"></span>
      </div>
      <div class="column-item">
        <span class="column-name">Description</span>
        <span class="empty-cell"></span>
      </div>
      <div class="column-item">
        <span class="column-name">Sample Type</span>
        <span class="empty-cell"></span>
      </div>
      <div class="column-item">
        <span class="column-name">Unit</span>
        <span class="empty-cell"></span>
      </div>
      <div class="column-item">
        <span class="column-name">Container</span>
        <span class="empty-cell"></span>
      </div>
      <div class="column-item">
        <span class="column-name">Mass Estimate</span>
        <span class="empty-cell"></span>
      </div>
    </div>
  </div>

  <script>
    // Dummy public sheet for demo (Sheet: https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit)
    const SPREADSHEET_ID = '1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms';
    const API_KEY = 'YOUR_API_KEY'; // Replace with your Google API key
    const RANGE = 'Class Data!A1:G'; // Includes header row

    let sheetData = [];
    let count = 1; // 1-based index for user navigation (first data row is count=1)

    function updateCountDisplay() {
      document.getElementById('pageCount').textContent = count;
    }

    function displayRow(idx) {
      if (!sheetData.length || idx >= sheetData.length) return;
      const row = sheetData[idx];
      const fields = [
        {selector: '.column-item:nth-child(1) .empty-cell', value: row[1] || ''}, // Timestamp
        {selector: '.column-item:nth-child(2) .empty-cell', value: row[4] || ''}, // Description
        {selector: '.column-item:nth-child(3) .empty-cell', value: row[5] || ''}, // Sample Type
        {selector: '.column-item:nth-child(4) .empty-cell', value: row[6] || ''}, // Unit
        {selector: '.column-item:nth-child(5) .empty-cell', value: row[10] || ''}, // Container
        {selector: '.column-item:nth-child(6) .empty-cell', value: row[8] || ''}, // Mass Estimate
      ];
      fields.forEach(f => {
        const el = document.querySelector(f.selector);
        if (el) el.textContent = f.value;
      });
      document.querySelector('.static-header h1').textContent = row[0] || 'Sample Name';
      updateCountDisplay();

      // Use the filtered total row count
      updateEvaInfo(row, idx, getTotalDataRows());
    }

    function updateEvaInfo(row, idx, totalRows) {
      // row[14] = column O (EVA), row[15] = column P (Station)
      const eva = row[14] || '';
      const station = row[15] || '';
      const sampleNum = idx; // idx is 1-based, matches count
      const total = totalRows;
      const infoStr = `EVA ${eva} Station ${station} Sample# ${sampleNum} of ${total}`;
      document.getElementById('evaInfo').textContent = infoStr;
    }

    function addCount() {
      if (count < sheetData.length - 1) { // -1 because row 0 is header
        count++;
        displayRow(count);
      }
    }

    function minusCount() {
      if (count > 1) {
        count--;
        displayRow(count);
      }
    }

    function getTotalDataRows() {
      // Exclude the header row (sheetData[0])
      return sheetData.slice(1).filter(
        row => row && row.some(cell => cell && cell.trim() !== '')
      ).length;
    }

    // Add this function to refresh only the current row's display
    function autoRefreshCurrentRow() {
      // Re-fetch the sheet data, then update the current row display
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${RANGE}?key=${API_KEY}`;
      fetch(url)
        .then(res => res.json())
        .then(data => {
          sheetData = data.values || [];
          // Make sure count is still in bounds after refresh
          if (count >= sheetData.length) count = sheetData.length - 1;
          displayRow(count);
        })
        .catch(err => {
          console.error('Auto-refresh failed:', err);
        });
    }

    document.getElementById('forwardButton').addEventListener('click', addCount);
    document.getElementById('backButton').addEventListener('click', minusCount);

    async function fetchSheetData() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${RANGE}?key=${API_KEY}`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        sheetData = data.values || [];
        count = 1;
        displayRow(count);
        // Start auto-refresh every 10 seconds (10000 ms)
        setInterval(autoRefreshCurrentRow, 10000);
      } catch (err) {
        alert('Failed to fetch sheet data.');
        console.error(err);
      }
    }

    window.onload = fetchSheetData;
  </script>
</body>
</html>